# Code Review
首先所有程序员都知道 `Code Review` 意义深远，但是实际操作过程中还是有不少问题，现在总结一下。

## 准备
前提你在团队里，或有相同岗位的人一同参与。

### 是否需要进行 Code Review ? 
按项目或产品线分类，以下类型建议开启 Code Review
- 公共服务：适用场景较多，影响面较大。
- 测试缺失：代码质量不可控。
- 新人密集：没有默契，能力参差不齐。
- 适用较新技术：代码后续维护成本较高。

不建议开启的类型包括：
- 断头项目：短期完成，后续不需要维护。
- 客观因素：时间紧任务重人员缺。

关键：因为事实上，Code Review 就是革工程师自己的命，但凡成员没有这个意愿，势必抵触，导致无法持续进行下去，所以以团队各成员的共同意愿为动力是关键。

### 初衷
- 找问题，保证项目在不同阶段、不同人参与时项目代码质量稳定。
- 工程师交流文化的营造。
- 提高工程师个人能力。

## Git
`Git` 提供良好的分支管理，是实现 `Code Review` 的前置条件。
特别注意两点：
- Branch
  - 项目存在几个长期分支，包括：`master`、`develop`、`preview` 等。长期分支中的代码均为稳定代码，简单的说，随时获取这些分支代码均能正常使用。
  - 项目存在多个短期分支，命名时前缀需要进行分类，type 包括：`hotfix`、`fixbug`、`feature`、`release` 等。命名规则，建议使用 "{type}-{name}" 组合。
  - 分支命名与分支主题保持一致。分支通常由某一具体需求而创建，不建议在其中参入其它主题的代码。
  - 分支合并
    - 建议使用 `git merge --no-ff` ，且短期分支**合并后必须删除**。
    - 从某个分支上创建的分支最终合并回某个分支。
    - 注意分支层级，建议单向合并。例如 `develop` 合并到 `preview` 合并到 `master` ，不能交错或反向。多看 graph，直观！
- Commit
  - Message 书写规则，建议使用 "{type} {content}" 组合。

#### Git 工作流参考：
- https://juejin.im/post/5a54386af265da3e3b7a6317
- https://lizhiyao.github.io/2015/12/12/use-git/
- http://www.ruanyifeng.com/blog/2015/12/git-workflow.html

## Lint
注意两方面，包括规则与指令。
- lint 使用的规则，必须使用整套规则，通常包括：`Possible Errors`、`Code Style`、`Best Practices` 等。自己不能制定整套规则的话，还是建议使用三方的规则。
- 项目必须单独部署 lint 指令，至少可以单独执行校验源码，建议集成为在发布、合并、打包的前置条件。

## Gitlab
用好 `Gitlab` 中提供了诸多功能，能高效的了解项目状态。

### Repository/Gragh
能够直观的查看项目的 `commit` 记录与 `branch` 操作。

### Merge Requests
#### Description 发起时的描述
通常分支来关联任务，任务有其 `wiki` 或 `pm`，将链接提供即可。

#### Assignee 指派给谁
原则上：自己 `open` 别自己 `merge`，指派给除自己以外任何人。

#### Code Review 如何看代码
通常 `Code Review` 的人包括：项目组人员、非组内成员。前者相较后者更了解项目背景与业务，所以可以指出与项目相关的错误。除与项目相关的错误以外，检视内容还包括以下方面：
- 代码规范
  - 分支代码与分支主题是否一致。
  - 注释可以很大程度的解决对代码业务流的理解，建议使用 [JSDoc](http://usejsdoc.org/)
  - 项目架构的合理性。简单的说，就是系统编码是否分层（编码的**位置**是否正确）。通常项目加入新开发者时或图快而迅速编码完成任务时会出现。
  - **代码风格**是否一致，如果发现不一致，请检查 lint 部署与执行。
- 潜在缺陷
  - 代码设计，通常由视图、控制器、路由、数据等组成项目的框架，检查各环节是否冗余或缺失对整个项目的维护相当重要。
  - 代码的**兼容性**，通常这个就的凭借经验了。
- Bug
  - 业务**逻辑判断**是否充分。

PS：代码是否实现指定功能，开发者自己、产品、测试均会校验，lint 会校验代码的低级问题（代码校验代码），剩下的就需要"人眼"（有丰富编码经验）来发现问题。


### Issues
通过 `issues` 方式将发现的问题告诉项目组。提交的内容格式最好使用模板，当没有模板时，内容建议包含：
- 发生的场景
- 图文并茂的方式描述问题（文字+截图）
- 改进或参考的建议


### CI/CD 持续集成
通常建议项目部署 `lint` 指令，结合 `CI/CD`，可以省去代码在提交到特别分支时的校验。
